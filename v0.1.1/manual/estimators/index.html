<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Estimators · Microstructure.jl</title><meta name="title" content="Estimators · Microstructure.jl"/><meta property="og:title" content="Estimators · Microstructure.jl"/><meta property="twitter:title" content="Estimators · Microstructure.jl"/><meta name="description" content="Documentation for Microstructure.jl."/><meta property="og:description" content="Documentation for Microstructure.jl."/><meta property="twitter:description" content="Documentation for Microstructure.jl."/><meta property="og:url" content="/manual/estimators/"/><meta property="twitter:url" content="/manual/estimators/"/><link rel="canonical" href="/manual/estimators/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Microstructure.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/1_build_models/">How to build a microstructure model</a></li><li><a class="tocitem" href="../../tutorials/2_quality_of_fit/">How to check quality of fitting and mcmc samples</a></li><li><a class="tocitem" href="../../tutorials/3_data_generation/">How to generate training datasets</a></li><li><a class="tocitem" href="../../tutorials/4_noise_propagation/">How to evaluate accuracy and precision</a></li><li><a class="tocitem" href="../../tutorials/5_model_selection/">Which model to use</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../dMRI/">I/O functions</a></li><li><a class="tocitem" href="../compartments/">Tissue Compartments</a></li><li><a class="tocitem" href="../models/">Microstructure Models</a></li><li class="is-active"><a class="tocitem" href>Estimators</a><ul class="internal"><li><a class="tocitem" href="#MCMC"><span>MCMC</span></a></li><li><a class="tocitem" href="#Neural-Networks"><span>Neural Networks</span></a></li></ul></li><li><a class="tocitem" href="../multithreads/">Multi threads</a></li></ul></li><li><a class="tocitem" href="../../guide/">Developer guide</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Estimators</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Estimators</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Tinggong/Microstructure.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Tinggong/Microstructure.jl/blob/main/docs/src/manual/estimators.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Estimators"><a class="docs-heading-anchor" href="#Estimators">Estimators</a><a id="Estimators-1"></a><a class="docs-heading-anchor-permalink" href="#Estimators" title="Permalink"></a></h1><h2 id="MCMC"><a class="docs-heading-anchor" href="#MCMC">MCMC</a><a id="MCMC-1"></a><a class="docs-heading-anchor-permalink" href="#MCMC" title="Permalink"></a></h2><h3 id="1.-Define-a-sampler-for-your-model"><a class="docs-heading-anchor" href="#1.-Define-a-sampler-for-your-model">1. Define a sampler for your model</a><a id="1.-Define-a-sampler-for-your-model-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Define-a-sampler-for-your-model" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.Sampler" href="#Microstructure.Sampler"><code>Microstructure.Sampler</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Sampler for a biophysical model     params: parameters (String) to sample in the model     prior<em>range: bounds for each parameter     proposal: Distribution to draw pertubations     paralinks: linking parameters in the model     nsamples: The total number of samples in a MCMC chain; default to 70000     burnin: The number of samples that will be discarded in the beginning of the chain; default to 20000     thinning: The interval to extract unrelated samples in the chain; default to 100 Example Sampler for ExCaliber     Sampler(         params = (&quot;axon.da&quot;,&quot;axon.dpara&quot;,&quot;extra.dperp</em>frac&quot;,&quot;fracs&quot;)         prior_range = ((1.0e-7,1.0e-5),(0.01e-9,0.9e-9),(0.0, 1.0),(0.0,1.0))         proposal = (Normal(0,0.25e-6), Normal(0,0.025e-9), Normal(0,0.05), MvNormal([0.0025 0 0;0 0.0001 0; 0 0 0.0001])) #; (0,0.05),Normal(0,0.01),Normal(0,0.01)]]         paralinks = (&quot;axon.d0&quot; =&gt; &quot;axon.dpara&quot;, &quot;extra.dpara&quot; =&gt; &quot;axon.dpara&quot;)     )</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_mcmc.jl#L41-L57">source</a></section></article><h3 id="2.-Define-a-noise-model"><a class="docs-heading-anchor" href="#2.-Define-a-noise-model">2. Define a noise model</a><a id="2.-Define-a-noise-model-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Define-a-noise-model" title="Permalink"></a></h3><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>Noise_model</code>. Check Documenter&#39;s build log for details.</p></div></div><h3 id="3.-Run-MCMC-on-your-model-and-data"><a class="docs-heading-anchor" href="#3.-Run-MCMC-on-your-model-and-data">3. Run MCMC on your model and data</a><a id="3.-Run-MCMC-on-your-model-and-data-1"></a><a class="docs-heading-anchor-permalink" href="#3.-Run-MCMC-on-your-model-and-data" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.mcmc!" href="#Microstructure.mcmc!"><code>Microstructure.mcmc!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Run mcmc for a model and sampler</p><p>Method 1 generates pertubations within function, creates and returns a dict chain, and modify final model estimates in place.     This method is useful in checking a few voxels, e.g. for quality of fitting, chain dignostics and optimizing sampler for models. </p><p>Method 2 takes chain and pertubations as input, mutating chain in place which can be used to calculate finial estimates and uncertainties.      This method is used for processing larger dataset, e.g. for whole-barin/slices.      This method is used together with multi-threads processing that pre-allocate spaces for caching chains, avoiding creating them for each voxel.      This method also reuses pertubations for faster speed, as we usually use a very large number of pertubations (e.g. 70000) to densely sample the proposal distributions. </p><p>Method 1 </p><pre><code class="language-julia-repl hljs">julia&gt; mcmc!(estimates,measurements,protocol,sampler,noise_model,rng)</code></pre><p>Method 2: &#39;chain&#39; can be Vector (modify elements) or Dict (push!); need to benchmark time difference</p><pre><code class="language-julia-repl hljs">julia&gt; mcmc!(chain,estimates,meas,protocol,sampler,pertubations,noise_model))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_mcmc.jl#L179-L199">source</a></section></article><h2 id="Neural-Networks"><a class="docs-heading-anchor" href="#Neural-Networks">Neural Networks</a><a id="Neural-Networks-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-Networks" title="Permalink"></a></h2><h3 id="1.-Specify-a-network-model-for-your-task"><a class="docs-heading-anchor" href="#1.-Specify-a-network-model-for-your-task">1. Specify a network model for your task</a><a id="1.-Specify-a-network-model-for-your-task-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Specify-a-network-model-for-your-task" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.NetworkArg" href="#Microstructure.NetworkArg"><code>Microstructure.NetworkArg</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">NetworkArg(model, protocol, params, paralinks, tissuetype, sigma, noise_type, 
hidden_layers, nsamples, nin, nout, dropoutp)</code></pre><p>contain fields that determine network architecture and training samples for a biophysical model</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_nn.jl#L7-L11">source</a></section></article><h3 id="2.-Specify-training-parameters"><a class="docs-heading-anchor" href="#2.-Specify-training-parameters">2. Specify training parameters</a><a id="2.-Specify-training-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Specify-training-parameters" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.TrainingArg" href="#Microstructure.TrainingArg"><code>Microstructure.TrainingArg</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">TrainingArg(batchsize, lossf, lr, epoch, tv_split, patience )</code></pre><p>Contain fields related to how network will be trained</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_nn.jl#L27-L30">source</a></section></article><h3 id="3.-Prepare-network-and-data-for-training"><a class="docs-heading-anchor" href="#3.-Prepare-network-and-data-for-training">3. Prepare network and data for training</a><a id="3.-Prepare-network-and-data-for-training-1"></a><a class="docs-heading-anchor-permalink" href="#3.-Prepare-network-and-data-for-training" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.prepare_training" href="#Microstructure.prepare_training"><code>Microstructure.prepare_training</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">prepare_trainning(arg::NetworkArg)</code></pre><p>return mlp,inputs,labels,gt mlp is the network model; inputs and labels are arrays of signals and scaled tissue parameters; gt is a dict containing the ground truth tissue parameters without scaling</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_nn.jl#L70-L75">source</a></section></article><h3 id="4.-Training-on-generated-training-samples"><a class="docs-heading-anchor" href="#4.-Training-on-generated-training-samples">4. Training on generated training samples</a><a id="4.-Training-on-generated-training-samples-1"></a><a class="docs-heading-anchor-permalink" href="#4.-Training-on-generated-training-samples" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.train_loop!" href="#Microstructure.train_loop!"><code>Microstructure.train_loop!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">train_loop!(mlp, trainingarg, inputs, labels)</code></pre><p>Train and update the mlp and return training logs</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_nn.jl#L156-L159">source</a></section></article><h3 id="5.-test-on-you-data"><a class="docs-heading-anchor" href="#5.-test-on-you-data">5. test on you data</a><a id="5.-test-on-you-data-1"></a><a class="docs-heading-anchor-permalink" href="#5.-test-on-you-data" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Microstructure.test" href="#Microstructure.test"><code>Microstructure.test</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test(mlp, data, ntest)</code></pre><p>apply trained mlp to test data ntest times to get mean and std of estimates</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/Tinggong/Microstructure.jl/blob/f1bb98e00322708fcf30b94985b6b80dd942c231/src/estimators_nn.jl#L205-L208">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../models/">« Microstructure Models</a><a class="docs-footer-nextpage" href="../multithreads/">Multi threads »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 16 April 2024 19:47">Tuesday 16 April 2024</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
